<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.58" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://theme-zhang.netlify.app/zh/basics/design-patterns/behavioral-patterns/Observer.html"><meta property="og:site_name" content="zhang"><meta property="og:title" content="è§‚å¯Ÿè€…æ¨¡å¼"><meta property="og:description" content="è§‚å¯Ÿè€…æ¨¡å¼ æˆ‘ä»¬å¸¸æŠŠ 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç±»ï¼šåˆ›å»ºå‹ã€ç»“æ„å‹ã€è¡Œä¸ºå‹ã€‚å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†åˆ›å»ºå‹å’Œç»“æ„å‹ï¼Œä»ä»Šå¤©èµ·ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œå¯¹è±¡çš„åˆ›å»ºâ€é—®é¢˜ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œç±»æˆ–å¯¹è±¡çš„ç»„åˆæˆ–ç»„è£…â€é—®é¢˜ï¼Œé‚£è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³çš„å°±æ˜¯â€œç±»æˆ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’â€é—®é¢˜ã€‚ è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼æ¯”è¾ƒå¤šï¼Œæœ‰ 11 ä¸ªï¼Œå‡ ä¹å äº† 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼çš„ä¸€åŠã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹æ¨¡å¼ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ ç¬¬ä¸€ä¸ªè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ˜¯åœ¨å®é™…çš„å¼€å‘ä¸­ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¸€ç§æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€‚æ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¼šå¯¹åº”ä¸åŒçš„ä»£ç å®ç°æ–¹å¼ï¼šæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚ä»Šå¤©æˆ‘ä¼šé‡ç‚¹è®²è§£åŸç†ã€å®ç°ã€åº”ç”¨åœºæ™¯ã€‚æœ€åä¼šå®ç°ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„å¼‚æ­¥éé˜»å¡çš„ EventBusï¼ŒåŠ æ·±å¯¹è¿™ä¸ªæ¨¡å¼çš„ç†è§£ã€‚"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-09T06:04:07.000Z"><meta property="og:locale" content="zh-CN"><meta property="og:locale:alternate" content="en-US"><meta property="article:modified_time" content="2022-12-09T06:04:07.000Z"><link rel="alternate" hreflang="en-us" href="https://theme-zhang.netlify.app/en/basics/design-patterns/behavioral-patterns/Observer.html"><title>è§‚å¯Ÿè€…æ¨¡å¼ | zhang</title><meta name="description" content="è§‚å¯Ÿè€…æ¨¡å¼ æˆ‘ä»¬å¸¸æŠŠ 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç±»ï¼šåˆ›å»ºå‹ã€ç»“æ„å‹ã€è¡Œä¸ºå‹ã€‚å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†åˆ›å»ºå‹å’Œç»“æ„å‹ï¼Œä»ä»Šå¤©èµ·ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œå¯¹è±¡çš„åˆ›å»ºâ€é—®é¢˜ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œç±»æˆ–å¯¹è±¡çš„ç»„åˆæˆ–ç»„è£…â€é—®é¢˜ï¼Œé‚£è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³çš„å°±æ˜¯â€œç±»æˆ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’â€é—®é¢˜ã€‚ è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼æ¯”è¾ƒå¤šï¼Œæœ‰ 11 ä¸ªï¼Œå‡ ä¹å äº† 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼çš„ä¸€åŠã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹æ¨¡å¼ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ ç¬¬ä¸€ä¸ªè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ˜¯åœ¨å®é™…çš„å¼€å‘ä¸­ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¸€ç§æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€‚æ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¼šå¯¹åº”ä¸åŒçš„ä»£ç å®ç°æ–¹å¼ï¼šæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚ä»Šå¤©æˆ‘ä¼šé‡ç‚¹è®²è§£åŸç†ã€å®ç°ã€åº”ç”¨åœºæ™¯ã€‚æœ€åä¼šå®ç°ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„å¼‚æ­¥éé˜»å¡çš„ EventBusï¼ŒåŠ æ·±å¯¹è¿™ä¸ªæ¨¡å¼çš„ç†è§£ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-51fbe53b.css" as="style"><link rel="stylesheet" href="/assets/style-51fbe53b.css">
    <link rel="modulepreload" href="/assets/app-563244e8.js"><link rel="modulepreload" href="/assets/framework-6f747a7a.js"><link rel="modulepreload" href="/assets/Observer.html-7f1446ff.js"><link rel="modulepreload" href="/assets/Observer.html-4e381d34.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/zh/" class="brand"><img class="logo" src="/logo.svg" alt="zhang"><!----><span class="site-name hide-in-pad">zhang</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/zh/" class="nav-link" aria-label="åšå®¢ä¸»é¡µ"><span class="icon iconfont icon-home"></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è®¡ç®—æœºåŸºç¡€"><span class="title"><span class="icon iconfont icon-rank"></span>è®¡ç®—æœºåŸºç¡€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/basics/algorithm/" class="nav-link" aria-label="ç®—æ³•"><span class="icon iconfont icon-rank"></span>ç®—æ³•<!----></a></li><li class="dropdown-item"><a href="/zh/basics/MySQL/" class="nav-link" aria-label="MySQLæ•°æ®åº“"><span class="icon iconfont icon-mysql"></span>MySQLæ•°æ®åº“<!----></a></li><li class="dropdown-item"><a href="/zh/basics/design-patterns/" class="nav-link active" aria-label="è®¾è®¡æ¨¡å¼"><span class="icon iconfont icon-repair"></span>è®¾è®¡æ¨¡å¼<!----></a></li><li class="dropdown-item"><a href="/zh/basics/OOP/" class="nav-link" aria-label="é¢å‘å¯¹è±¡"><span class="icon iconfont icon-people"></span>é¢å‘å¯¹è±¡<!----></a></li><li class="dropdown-item"><a href="/zh/basics/design-principles/" class="nav-link" aria-label="è®¾è®¡æ€æƒ³å’ŒåŸåˆ™"><span class="icon iconfont icon-people"></span>è®¾è®¡æ€æƒ³å’ŒåŸåˆ™<!----></a></li><li class="dropdown-item"><a href="/zh/basics/distribute/" class="nav-link" aria-label="åˆ†å¸ƒå¼"><span class="icon iconfont icon-snow"></span>åˆ†å¸ƒå¼<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è¯­è¨€"><span class="title"><span class="icon iconfont icon-language"></span>è¯­è¨€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/zh/language/Java/" class="nav-link" aria-label="Java"><span class="icon iconfont icon-java"></span>Java<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button class="dropdown-title" type="button" aria-label="é€‰æ‹©è¯­è¨€"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/en/" class="nav-link" aria-label="English"><!---->English<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html" class="router-link-active router-link-exact-active nav-link active" aria-label="ç®€ä½“ä¸­æ–‡"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li></ul></button></div></div><div class="nav-item"><a class="repo-link" href="https://github.com/zhanglianfen/zhanglianfen.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><div class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></div><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-creative"></span><span class="title">ç®—æ³•</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><span class="title">MySQL</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-repair"></span><span class="title">é¢å‘å¯¹è±¡</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-snow"></span><span class="title">åˆ†å¸ƒå¼</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-repair"></span><span class="title">è®¾è®¡åŸåˆ™å’Œæ€æƒ³</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-repair"></span><span class="title">è®¾è®¡æ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/basics/design-patterns/" class="nav-link sidebar-link sidebar-page" aria-label="è®¾è®¡æ¨¡å¼"><span class="icon iconfont icon-article"></span>è®¾è®¡æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">åˆ›å»ºè€…æ¨¡å¼</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ç»“æ„å‹æ¨¡å¼</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">è¡Œä¸ºå‹æ¨¡å¼</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/" class="nav-link sidebar-link sidebar-page" aria-label="æ¦‚è¿°"><!---->æ¦‚è¿°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="è§‚å¯Ÿè€…æ¨¡å¼"><!---->è§‚å¯Ÿè€…æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ"><!---->åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼"><!---->åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°"><!---->å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#eventbus-æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="EventBus æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»"><!---->EventBus æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª-eventbus-æ¡†æ¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª EventBus æ¡†æ¶"><!---->æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª EventBus æ¡†æ¶<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_1-subscribe" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.Subscribe"><!---->1.Subscribe<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_2-observeraction" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.ObserverAction"><!---->2.ObserverAction<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_3-observerregistry" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.ObserverRegistry"><!---->3.ObserverRegistry<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_4-eventbus" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.EventBus"><!---->4.EventBus<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_5-asynceventbus" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.AsyncEventBus"><!---->5.AsyncEventBus<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ€è€ƒé¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€è€ƒé¢˜"><!---->æ€è€ƒé¢˜<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Template-method.html" class="nav-link sidebar-link sidebar-page" aria-label="æ¨¡æ¿æ¨¡å¼"><!---->æ¨¡æ¿æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Strategy.html" class="nav-link sidebar-link sidebar-page" aria-label="ç­–ç•¥æ¨¡å¼"><!---->ç­–ç•¥æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Chain-Of-Responsibility.html" class="nav-link sidebar-link sidebar-page" aria-label="èŒè´£é“¾æ¨¡å¼"><!---->èŒè´£é“¾æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/State.html" class="nav-link sidebar-link sidebar-page" aria-label="çŠ¶æ€æ¨¡å¼"><!---->çŠ¶æ€æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Iterator.html" class="nav-link sidebar-link sidebar-page" aria-label="è¿­ä»£å™¨æ¨¡å¼"><!---->è¿­ä»£å™¨æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Visitor.html" class="nav-link sidebar-link sidebar-page" aria-label="è®¿é—®è€…æ¨¡å¼"><!---->è®¿é—®è€…æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Memento.html" class="nav-link sidebar-link sidebar-page" aria-label="å¤‡å¿˜å½•æ¨¡å¼"><!---->å¤‡å¿˜å½•æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Command.html" class="nav-link sidebar-link sidebar-page" aria-label="å‘½ä»¤æ¨¡å¼"><!---->å‘½ä»¤æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Interpreter.html" class="nav-link sidebar-link sidebar-page" aria-label="è§£é‡Šå™¨æ¨¡å¼"><!---->è§£é‡Šå™¨æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/zh/basics/design-patterns/behavioral-patterns/Mediator.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸­ä»‹è€…æ¨¡å¼"><!---->ä¸­ä»‹è€…æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->è§‚å¯Ÿè€…æ¨¡å¼</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://www.cnblogs.com/zhang1f/" target="_blank" rel="noopener noreferrer">Mr.Zhang</a></span><span property="author" content="Mr.Zhang"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-12-09T06:04:07.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category4 clickable" role="navigation">è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼</span><meta property="articleSection" content="è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼"></span><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 24 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT24M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ" class="router-link-active router-link-exact-active toc-link level2">åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼" class="router-link-active router-link-exact-active toc-link level2">åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°" class="router-link-active router-link-exact-active toc-link level2">å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#eventbus-æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">EventBus æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª-eventbus-æ¡†æ¶" class="router-link-active router-link-exact-active toc-link level2">æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª EventBus æ¡†æ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_1-subscribe" class="router-link-active router-link-exact-active toc-link level3">1.Subscribe</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_2-observeraction" class="router-link-active router-link-exact-active toc-link level3">2.ObserverAction</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_3-observerregistry" class="router-link-active router-link-exact-active toc-link level3">3.ObserverRegistry</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_4-eventbus" class="router-link-active router-link-exact-active toc-link level3">4.EventBus</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#_5-asynceventbus" class="router-link-active router-link-exact-active toc-link level3">5.AsyncEventBus</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/zh/basics/design-patterns/behavioral-patterns/Observer.html#æ€è€ƒé¢˜" class="router-link-active router-link-exact-active toc-link level2">æ€è€ƒé¢˜</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="è§‚å¯Ÿè€…æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#è§‚å¯Ÿè€…æ¨¡å¼" aria-hidden="true">#</a> è§‚å¯Ÿè€…æ¨¡å¼</h1><p>æˆ‘ä»¬å¸¸æŠŠ 23 ç§ç»å…¸çš„è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç±»ï¼šåˆ›å»ºå‹ã€ç»“æ„å‹ã€è¡Œä¸ºå‹ã€‚å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†åˆ›å»ºå‹å’Œç»“æ„å‹ï¼Œä»ä»Šå¤©èµ·ï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œå¯¹è±¡çš„åˆ›å»ºâ€é—®é¢˜ï¼Œç»“æ„å‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³â€œç±»æˆ–å¯¹è±¡çš„ç»„åˆæˆ–ç»„è£…â€é—®é¢˜ï¼Œé‚£è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¸»è¦è§£å†³çš„å°±æ˜¯â€œç±»æˆ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’â€é—®é¢˜ã€‚</p><p>è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼æ¯”è¾ƒå¤šï¼Œæœ‰ 11 ä¸ªï¼Œå‡ ä¹å äº† 23 ç§ç»å…¸è®¾è®¡æ¨¡å¼çš„ä¸€åŠã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€æ¨¡æ¿æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€ä¸­ä»‹æ¨¡å¼ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¹ ç¬¬ä¸€ä¸ªè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ˜¯åœ¨å®é™…çš„å¼€å‘ä¸­ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¸€ç§æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼ã€‚æ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¼šå¯¹åº”ä¸åŒçš„ä»£ç å®ç°æ–¹å¼ï¼šæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚ä»Šå¤©æˆ‘ä¼šé‡ç‚¹è®²è§£åŸç†ã€å®ç°ã€åº”ç”¨åœºæ™¯ã€‚æœ€åä¼šå®ç°ä¸€ä¸ªåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„å¼‚æ­¥éé˜»å¡çš„ EventBusï¼ŒåŠ æ·±å¯¹è¿™ä¸ªæ¨¡å¼çš„ç†è§£ã€‚</p><h2 id="åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ" tabindex="-1"><a class="header-anchor" href="#åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ" aria-hidden="true">#</a> åŸç†åŠåº”ç”¨åœºæ™¯å‰–æ</h2><p><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼ˆObserver Design Patternï¼‰ä¹Ÿè¢«ç§°ä¸º<strong>å‘å¸ƒè®¢é˜…æ¨¡å¼</strong>ï¼ˆPublish-Subscribe Design Patternï¼‰ã€‚åœ¨ GoF çš„ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ä¸­ï¼Œå®ƒçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.</p></blockquote><p>ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯ï¼šåœ¨å¯¹è±¡ä¹‹é—´å®šä¹‰ä¸€ä¸ªä¸€å¯¹å¤šçš„ä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¾èµ–çš„å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨æ”¶åˆ°é€šçŸ¥ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¢«ä¾èµ–çš„å¯¹è±¡å«ä½œ<strong>è¢«è§‚å¯Ÿè€…</strong>ï¼ˆObservableï¼‰ï¼Œä¾èµ–çš„å¯¹è±¡å«ä½œ<strong>è§‚å¯Ÿè€…</strong>ï¼ˆObserverï¼‰ã€‚ä¸è¿‡ï¼Œåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œè¿™ä¸¤ç§å¯¹è±¡çš„ç§°å‘¼æ˜¯æ¯”è¾ƒçµæ´»çš„ï¼Œæœ‰å„ç§ä¸åŒçš„å«æ³•ï¼Œæ¯”å¦‚ï¼šSubject-Observerã€Publisher-Subscriberã€Producer-Consumerã€EventEmitter-EventListenerã€Dispatcher-Listenerã€‚ä¸ç®¡æ€ä¹ˆç§°å‘¼ï¼Œåªè¦åº”ç”¨åœºæ™¯ç¬¦åˆåˆšåˆšç»™å‡ºçš„å®šä¹‰ï¼Œéƒ½å¯ä»¥çœ‹ä½œè§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><p>å®é™…ä¸Šï¼Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ½è±¡çš„æ¨¡å¼ï¼Œæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼Œæœ‰å®Œå…¨ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå¾…ä¼šæˆ‘ä»¬ä¼šè¯¦ç»†åœ°è®²åˆ°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹å…¶ä¸­æœ€ç»å…¸çš„ä¸€ç§å®ç°æ–¹å¼ã€‚è¿™ä¹Ÿæ˜¯åœ¨è®²åˆ°è¿™ç§æ¨¡å¼çš„æ—¶å€™ï¼Œå¾ˆå¤šä¹¦ç±æˆ–èµ„æ–™ç»™å‡ºçš„æœ€å¸¸è§çš„å®ç°æ–¹å¼ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">&gt;</span></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Observer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">Observer</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Observer</span> observer <span class="token operator">:</span> observers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteObserverOne</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//TODO: è·å–æ¶ˆæ¯é€šçŸ¥ï¼Œæ‰§è¡Œè‡ªå·±çš„é€»è¾‘...</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ConcreteObserverOne is notified.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteObserverTwo</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//TODO: è·å–æ¶ˆæ¯é€šçŸ¥ï¼Œæ‰§è¡Œè‡ªå·±çš„é€»è¾‘...</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ConcreteObserverTwo is notified.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ConcreteSubject</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subject<span class="token punctuation">.</span><span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteObserverOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subject<span class="token punctuation">.</span><span class="token function">registerObserver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcreteObserverTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subject<span class="token punctuation">.</span><span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šï¼Œä¸Šé¢çš„ä»£ç ç®—æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„â€œæ¨¡æ¿ä»£ç â€ï¼Œåªèƒ½åæ˜ å¤§ä½“çš„è®¾è®¡æ€è·¯ã€‚åœ¨çœŸå®çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œå¹¶ä¸éœ€è¦ç…§æ¬ä¸Šé¢çš„æ¨¡æ¿ä»£ç ã€‚è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°æ–¹æ³•å„å¼å„æ ·ï¼Œå‡½æ•°ã€ç±»çš„å‘½åç­‰ä¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯çš„ä¸åŒæœ‰å¾ˆå¤§çš„å·®åˆ«ï¼Œæ¯”å¦‚ register å‡½æ•°è¿˜å¯ä»¥å«ä½œ attachï¼Œremove å‡½æ•°è¿˜å¯ä»¥å«ä½œ detach ç­‰ç­‰ã€‚ä¸è¿‡ï¼Œä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œè®¾è®¡æ€è·¯éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚</p><p>åŸç†å’Œä»£ç å®ç°éƒ½éå¸¸ç®€å•ï¼Œä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œä¸éœ€è¦æˆ‘è¿‡å¤šçš„è§£é‡Šã€‚æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥é‡ç‚¹è®²ä¸€ä¸‹ï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç”¨åˆ°è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿæˆ–è€…è¯´ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ª P2P æŠ•èµ„ç†è´¢ç³»ç»Ÿï¼Œç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¼šç»™ç”¨æˆ·å‘æ”¾æŠ•èµ„ä½“éªŒé‡‘ã€‚ä»£ç å®ç°å¤§è‡´æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
  <span class="token keyword">private</span> <span class="token class-name">PromotionService</span> promotionService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
  <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//çœç•¥è¾“å…¥å‚æ•°çš„æ ¡éªŒä»£ç </span>
    <span class="token comment">//çœç•¥userService.register()å¼‚å¸¸çš„try-catchä»£ç </span>
    <span class="token keyword">long</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    promotionService<span class="token punctuation">.</span><span class="token function">issueNewUserExperienceCash</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> userId<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶æ³¨å†Œæ¥å£åšäº†ä¸¤ä»¶äº‹æƒ…ï¼Œæ³¨å†Œå’Œå‘æ”¾ä½“éªŒé‡‘ï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ‰©å±•å’Œä¿®æ”¹çš„éœ€æ±‚ï¼Œç°åœ¨çš„ä»£ç å®ç°æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¦‚æœéå¾—ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå°±éœ€è¦å¼•å…¥æ›´å¤šçš„ç±»å’Œæ›´åŠ å¤æ‚çš„ä»£ç ç»“æ„ï¼Œåå€’æ˜¯ä¸€ç§è¿‡åº¦è®¾è®¡ã€‚</p><p>ç›¸åï¼Œå¦‚æœéœ€æ±‚é¢‘ç¹å˜åŠ¨ï¼Œæ¯”å¦‚ï¼Œç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åï¼Œä¸å†å‘æ”¾ä½“éªŒé‡‘ï¼Œè€Œæ˜¯æ”¹ä¸ºå‘æ”¾ä¼˜æƒ åˆ¸ï¼Œå¹¶ä¸”è¿˜è¦ç»™ç”¨æˆ·å‘é€ä¸€å°â€œæ¬¢è¿æ³¨å†ŒæˆåŠŸâ€çš„ç«™å†…ä¿¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦é¢‘ç¹åœ°ä¿®æ”¹ register() å‡½æ•°ä¸­çš„ä»£ç ï¼Œè¿åå¼€é—­åŸåˆ™ã€‚è€Œä¸”ï¼Œå¦‚æœæ³¨å†ŒæˆåŠŸä¹‹åéœ€è¦æ‰§è¡Œçš„åç»­æ“ä½œè¶Šæ¥è¶Šå¤šï¼Œé‚£ register() å‡½æ•°çš„é€»è¾‘ä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä¹Ÿå°±å½±å“åˆ°ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å°±èƒ½æ´¾ä¸Šç”¨åœºäº†ã€‚åˆ©ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œäº†é‡æ„ã€‚é‡æ„ä¹‹åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RegObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegPromotionObserver</span> <span class="token keyword">implements</span> <span class="token class-name">RegObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">PromotionService</span> promotionService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
    
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promotionService<span class="token punctuation">.</span><span class="token function">issueNewUserExperienceCash</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegNotificationObserver</span> <span class="token keyword">implements</span> <span class="token class-name">RegObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">NotificationService</span> notificationService<span class="token punctuation">;</span>
    
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    notificationService<span class="token punctuation">.</span><span class="token function">sendInboxMessage</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token string">&quot;Welcome...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegObserver</span><span class="token punctuation">&gt;</span></span> regObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token comment">// ä¸€æ¬¡æ€§è®¾ç½®å¥½ï¼Œä¹‹åä¹Ÿä¸å¯èƒ½åŠ¨æ€çš„ä¿®æ”¹</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRegObservers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegObserver</span><span class="token punctuation">&gt;</span></span> observers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    regObservers<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>observers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//çœç•¥è¾“å…¥å‚æ•°çš„æ ¡éªŒä»£ç </span>
    <span class="token comment">//çœç•¥userService.register()å¼‚å¸¸çš„try-catchä»£ç </span>
    <span class="token keyword">long</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RegObserver</span> observer <span class="token operator">:</span> regObservers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">handleRegSuccess</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      
    <span class="token keyword">return</span> userId<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„è§‚å¯Ÿè€…çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼Œç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åï¼Œæ¨é€ç”¨æˆ·æ³¨å†Œä¿¡æ¯ç»™å¤§æ•°æ®å¾ä¿¡ç³»ç»Ÿï¼ŒåŸºäºè§‚å¯Ÿè€…æ¨¡å¼çš„ä»£ç å®ç°ï¼ŒUserController ç±»çš„ register() å‡½æ•°å®Œå…¨ä¸éœ€è¦ä¿®æ”¹ï¼Œåªéœ€è¦å†æ·»åŠ ä¸€ä¸ªå®ç°äº† RegObserver æ¥å£çš„ç±»ï¼Œå¹¶ä¸”é€šè¿‡ setRegObservers() å‡½æ•°å°†å®ƒæ³¨å†Œåˆ° UserController ç±»ä¸­å³å¯ã€‚</p><p>ä¸è¿‡ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼Œå½“æˆ‘ä»¬æŠŠå‘é€ä½“éªŒé‡‘æ›¿æ¢ä¸ºå‘é€ä¼˜æƒ åˆ¸çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ RegPromotionObserver ç±»ä¸­ handleRegSuccess() å‡½æ•°çš„ä»£ç ï¼Œè¿™è¿˜æ˜¯è¿åå¼€é—­åŸåˆ™å‘€ï¼Ÿä½ è¯´å¾—æ²¡é”™ï¼Œä¸è¿‡ï¼Œç›¸å¯¹äº register() å‡½æ•°æ¥è¯´ï¼ŒhandleRegSuccess() å‡½æ•°çš„é€»è¾‘è¦ç®€å•å¾ˆå¤šï¼Œä¿®æ”¹æ›´ä¸å®¹æ˜“å‡ºé”™ï¼Œå¼•å…¥ bug çš„é£é™©æ›´ä½ã€‚</p><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œå®é™…ä¸Šï¼Œ**è®¾è®¡æ¨¡å¼è¦å¹²çš„äº‹æƒ…å°±æ˜¯è§£è€¦ã€‚åˆ›å»ºå‹æ¨¡å¼æ˜¯å°†åˆ›å»ºå’Œä½¿ç”¨ä»£ç è§£è€¦ï¼Œç»“æ„å‹æ¨¡å¼æ˜¯å°†ä¸åŒåŠŸèƒ½ä»£ç è§£è€¦ï¼Œè¡Œä¸ºå‹æ¨¡å¼æ˜¯å°†ä¸åŒçš„è¡Œä¸ºä»£ç è§£è€¦ï¼Œå…·ä½“åˆ°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒæ˜¯å°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä»£ç è§£è€¦ã€‚**å€ŸåŠ©è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬åˆ©ç”¨æ›´å¥½çš„ä»£ç ç»“æ„ï¼Œå°†ä¸€å¤§å¨ä»£ç æ‹†åˆ†æˆèŒè´£æ›´å•ä¸€çš„å°ç±»ï¼Œè®©å…¶æ»¡è¶³å¼€é—­åŸåˆ™ã€é«˜å†…èšæ¾è€¦åˆç­‰ç‰¹æ€§ï¼Œä»¥æ­¤æ¥æ§åˆ¶å’Œåº”å¯¹ä»£ç çš„å¤æ‚æ€§ï¼Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§ã€‚</p><h2 id="åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼" aria-hidden="true">#</a> åŸºäºä¸åŒåº”ç”¨åœºæ™¯çš„ä¸åŒå®ç°æ–¹å¼</h2><p>è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå°åˆ°ä»£ç å±‚é¢çš„è§£è€¦ï¼Œå¤§åˆ°æ¶æ„å±‚é¢çš„ç³»ç»Ÿè§£è€¦ï¼Œå†æˆ–è€…ä¸€äº›äº§å“çš„è®¾è®¡æ€è·¯ï¼Œéƒ½æœ‰è¿™ç§æ¨¡å¼çš„å½±å­ï¼Œæ¯”å¦‚ï¼Œé‚®ä»¶è®¢é˜…ã€RSS Feedsï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><p>ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼ä¹Ÿæœ‰æˆªç„¶ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå¼€ç¯‡çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚</p><p>ä¹‹å‰è®²åˆ°çš„å®ç°æ–¹å¼ï¼Œä»åˆšåˆšçš„åˆ†ç±»æ–¹å¼ä¸Šæ¥çœ‹ï¼Œå®ƒæ˜¯ä¸€ç§åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ã€‚è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä»£ç åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…æ‰§è¡Œï¼Œè¢«è§‚å¯Ÿè€…ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„è§‚å¯Ÿè€…ä»£ç éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰æ‰§è¡Œåç»­çš„ä»£ç ã€‚å¯¹ç…§ä¸Šé¢è®²åˆ°çš„ç”¨æˆ·æ³¨å†Œçš„ä¾‹å­ï¼Œregister() å‡½æ•°ä¾æ¬¡è°ƒç”¨æ‰§è¡Œæ¯ä¸ªè§‚å¯Ÿè€…çš„ handleRegSuccess() å‡½æ•°ï¼Œç­‰åˆ°éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰ä¼šè¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚</p><p>å¦‚æœæ³¨å†Œæ¥å£æ˜¯ä¸€ä¸ªè°ƒç”¨æ¯”è¾ƒé¢‘ç¹çš„æ¥å£ï¼Œå¯¹æ€§èƒ½éå¸¸æ•æ„Ÿï¼Œå¸Œæœ›æ¥å£çš„å“åº”æ—¶é—´å°½å¯èƒ½çŸ­ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°†åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼æ”¹ä¸ºå¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼Œä»¥æ­¤æ¥å‡å°‘å“åº”æ—¶é—´ã€‚å…·ä½“æ¥è®²ï¼Œå½“ userService.register() å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œè§‚å¯Ÿè€…çš„ handleRegSuccess() å‡½æ•°ï¼Œè¿™æ · userController.register() å‡½æ•°å°±ä¸éœ€è¦ç­‰åˆ°æ‰€æœ‰çš„ handleRegSuccess() å‡½æ•°éƒ½æ‰§è¡Œå®Œæˆä¹‹åæ‰è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚userController.register() å‡½æ•°ä»æ‰§è¡Œ 3 ä¸ª SQL è¯­å¥æ‰è¿”å›ï¼Œå‡å°‘åˆ°åªéœ€è¦æ‰§è¡Œ 1 ä¸ª SQL è¯­å¥å°±è¿”å›ï¼Œå“åº”æ—¶é—´ç²—ç•¥æ¥è®²å‡å°‘ä¸ºåŸæ¥çš„ 1/3ã€‚</p><p>é‚£å¦‚ä½•å®ç°ä¸€ä¸ªå¼‚æ­¥éé˜»å¡çš„è§‚å¯Ÿè€…æ¨¡å¼å‘¢ï¼Ÿç®€å•ä¸€ç‚¹çš„åšæ³•æ˜¯ï¼Œåœ¨æ¯ä¸ª handleRegSuccess() å‡½æ•°ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»£ç ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„å®ç°æ–¹å¼ï¼Œé‚£å°±æ˜¯åŸºäº EventBus æ¥å®ç°ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä¸å±•å¼€è®²è§£äº†ã€‚åœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘ä¼šç”¨ä¸€èŠ‚è¯¾çš„æ—¶é—´ï¼Œå€Ÿé‰´ Google Guava EventBus æ¡†æ¶çš„è®¾è®¡æ€æƒ³ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ å¼€å‘ä¸€ä¸ªæ”¯æŒå¼‚æ­¥éé˜»å¡çš„ EventBus æ¡†æ¶ã€‚å®ƒå¯ä»¥å¤ç”¨åœ¨ä»»ä½•éœ€è¦å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨åœºæ™¯ä¸­ã€‚</p><p>åˆšåˆšè®²åˆ°çš„ä¸¤ä¸ªåœºæ™¯ï¼Œä¸ç®¡æ˜¯åŒæ­¥é˜»å¡å®ç°æ–¹å¼è¿˜æ˜¯å¼‚æ­¥éé˜»å¡å®ç°æ–¹å¼ï¼Œéƒ½æ˜¯è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ã€‚å¦‚æœç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å‘é€ç”¨æˆ·ä¿¡æ¯ç»™å¤§æ•°æ®å¾ä¿¡ç³»ç»Ÿï¼Œè€Œå¤§æ•°æ®å¾ä¿¡ç³»ç»Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼Œè·Ÿå®ƒä¹‹é—´çš„äº¤äº’æ˜¯è·¨ä¸åŒè¿›ç¨‹çš„ï¼Œé‚£å¦‚ä½•å®ç°ä¸€ä¸ªè·¨è¿›ç¨‹çš„è§‚å¯Ÿè€…æ¨¡å¼å‘¢ï¼Ÿ</p><p>å¦‚æœå¤§æ•°æ®å¾ä¿¡ç³»ç»Ÿæä¾›äº†å‘é€ç”¨æˆ·æ³¨å†Œä¿¡æ¯çš„ RPC æ¥å£ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æ²¿ç”¨ä¹‹å‰çš„å®ç°æ€è·¯ï¼Œåœ¨ handleRegSuccess() å‡½æ•°ä¸­è°ƒç”¨ RPC æ¥å£æ¥å‘é€æ•°æ®ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æœ‰æ›´åŠ ä¼˜é›…ã€æ›´åŠ å¸¸ç”¨çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œé‚£å°±æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼Œæ¯”å¦‚ ActiveMQï¼‰æ¥å®ç°ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§å®ç°æ–¹å¼ä¹Ÿæœ‰å¼Šç«¯ï¼Œé‚£å°±æ˜¯éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„ç³»ç»Ÿï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œå¢åŠ äº†ç»´æŠ¤æˆæœ¬ã€‚ä¸è¿‡ï¼Œå®ƒçš„å¥½å¤„ä¹Ÿéå¸¸æ˜æ˜¾ã€‚åœ¨åŸæ¥çš„å®ç°æ–¹å¼ä¸­ï¼Œè§‚å¯Ÿè€…éœ€è¦æ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…ä¸­ï¼Œè¢«è§‚å¯Ÿè€…éœ€è¦ä¾æ¬¡éå†è§‚å¯Ÿè€…æ¥å‘é€æ¶ˆæ¯ã€‚è€ŒåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ–¹å¼ï¼Œè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…è§£è€¦æ›´åŠ å½»åº•ï¼Œä¸¤éƒ¨åˆ†çš„è€¦åˆæ›´å°ã€‚è¢«è§‚å¯Ÿè€…å®Œå…¨ä¸æ„ŸçŸ¥è§‚å¯Ÿè€…ï¼ŒåŒç†ï¼Œè§‚å¯Ÿè€…ä¹Ÿå®Œå…¨ä¸æ„ŸçŸ¥è¢«è§‚å¯Ÿè€…ã€‚è¢«è§‚å¯Ÿè€…åªç®¡å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè§‚å¯Ÿè€…åªç®¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯æ¥æ‰§è¡Œç›¸åº”çš„é€»è¾‘ã€‚</p><h2 id="å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°" aria-hidden="true">#</a> å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼çš„ç®€æ˜“å®ç°</h2><blockquote><p>ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†è§‚å¯Ÿè€…æ¨¡å¼çš„åŸç†ã€å®ç°ã€åº”ç”¨åœºæ™¯ï¼Œé‡ç‚¹ä»‹ç»äº†ä¸åŒåº”ç”¨åœºæ™¯ä¸‹ï¼Œå‡ ç§ä¸åŒçš„å®ç°æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼šåŒæ­¥é˜»å¡ã€å¼‚æ­¥éé˜»å¡ã€è¿›ç¨‹å†…ã€è¿›ç¨‹é—´çš„å®ç°æ–¹å¼ã€‚</p><p>åŒæ­¥é˜»å¡æ˜¯æœ€ç»å…¸çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä»£ç è§£è€¦ï¼›å¼‚æ­¥éé˜»å¡é™¤äº†èƒ½å®ç°ä»£ç è§£è€¦ä¹‹å¤–ï¼Œè¿˜èƒ½æé«˜ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼›è¿›ç¨‹é—´çš„è§‚å¯Ÿè€…æ¨¡å¼è§£è€¦æ›´åŠ å½»åº•ï¼Œä¸€èˆ¬æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ï¼Œç”¨æ¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„äº¤äº’ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬èšç„¦äºå¼‚æ­¥éé˜»å¡çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¸¦ä½ å®ç°ä¸€ä¸ªç±»ä¼¼ Google Guava EventBus çš„é€šç”¨æ¡†æ¶ã€‚ç­‰ä½ å­¦å®Œæœ¬èŠ‚è¯¾ä¹‹åï¼Œä½ ä¼šå‘ç°ï¼Œå®ç°ä¸€ä¸ªæ¡†æ¶ä¹Ÿå¹¶éä¸€ä»¶éš¾äº‹ã€‚</p></blockquote><p>å¯¹äºå¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¦‚æœåªæ˜¯å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬ï¼Œä¸è€ƒè™‘ä»»ä½•é€šç”¨æ€§ã€å¤ç”¨æ€§ï¼Œå®é™…ä¸Šæ˜¯éå¸¸å®¹æ˜“çš„ã€‚</p><p>æˆ‘ä»¬æœ‰ä¸¤ç§å®ç°æ–¹å¼ã€‚å…¶ä¸­ä¸€ç§æ˜¯ï¼šåœ¨æ¯ä¸ª handleRegSuccess() å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œä»£ç é€»è¾‘ï¼›å¦ä¸€ç§æ˜¯ï¼šåœ¨ UserController çš„ register() å‡½æ•°ä¸­ä½¿ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œæ¯ä¸ªè§‚å¯Ÿè€…çš„ handleRegSuccess() å‡½æ•°ã€‚ä¸¤ç§å®ç°æ–¹å¼çš„å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ç¬¬ä¸€ç§å®ç°æ–¹å¼ï¼Œå…¶ä»–ç±»ä»£ç ä¸å˜ï¼Œå°±æ²¡æœ‰å†é‡å¤ç½—åˆ—</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegPromotionObserver</span> <span class="token keyword">implements</span> <span class="token class-name">RegObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">PromotionService</span> promotionService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
    
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        promotionService<span class="token punctuation">.</span><span class="token function">issueNewUserExperienceCash</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œå…¶ä»–ç±»ä»£ç ä¸å˜ï¼Œå°±æ²¡æœ‰å†é‡å¤ç½—åˆ—</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegObserver</span><span class="token punctuation">&gt;</span></span> regObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">;</span>
    
  <span class="token keyword">public</span> <span class="token class-name">UserController</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>executor <span class="token operator">=</span> executor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRegObservers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RegObserver</span><span class="token punctuation">&gt;</span></span> observers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    regObservers<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>observers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//çœç•¥è¾“å…¥å‚æ•°çš„æ ¡éªŒä»£ç </span>
    <span class="token comment">//çœç•¥userService.register()å¼‚å¸¸çš„try-catchä»£ç </span>
    <span class="token keyword">long</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RegObserver</span> observer <span class="token operator">:</span> regObservers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          observer<span class="token punctuation">.</span><span class="token function">handleRegSuccess</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      
    <span class="token keyword">return</span> userId<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºç¬¬ä¸€ç§å®ç°æ–¹å¼ï¼Œé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”å¹¶å‘çº¿ç¨‹æ•°æ— æ³•æ§åˆ¶ï¼Œåˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ä¼šå¯¼è‡´å †æ ˆæº¢å‡ºã€‚ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œå°½ç®¡åˆ©ç”¨äº†çº¿ç¨‹æ± è§£å†³äº†ç¬¬ä¸€ç§å®ç°æ–¹å¼çš„é—®é¢˜ï¼Œä½†çº¿ç¨‹æ± ã€å¼‚æ­¥æ‰§è¡Œé€»è¾‘éƒ½è€¦åˆåœ¨äº† register() å‡½æ•°ä¸­ï¼Œå¢åŠ äº†è¿™éƒ¨åˆ†ä¸šåŠ¡ä»£ç çš„ç»´æŠ¤æˆæœ¬ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„éœ€æ±‚æ›´åŠ æç«¯ä¸€ç‚¹ï¼Œéœ€è¦åœ¨åŒæ­¥é˜»å¡å’Œå¼‚æ­¥éé˜»å¡ä¹‹é—´çµæ´»åˆ‡æ¢ï¼Œé‚£å°±è¦ä¸åœåœ°ä¿®æ”¹ UserController çš„ä»£ç ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­ï¼Œä¸æ­¢ä¸€ä¸ªä¸šåŠ¡æ¨¡å—éœ€è¦ç”¨åˆ°å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé‚£è¿™æ ·çš„ä»£ç å®ç°ä¹Ÿæ— æ³•åšåˆ°å¤ç”¨ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¡†æ¶çš„ä½œç”¨æœ‰ï¼šéšè—å®ç°ç»†èŠ‚ï¼Œé™ä½å¼€å‘éš¾åº¦ï¼Œåšåˆ°ä»£ç å¤ç”¨ï¼Œè§£è€¦ä¸šåŠ¡ä¸éä¸šåŠ¡ä»£ç ï¼Œè®©ç¨‹åºå‘˜èšç„¦ä¸šåŠ¡å¼€å‘ã€‚é’ˆå¯¹å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒæŠ½è±¡æˆæ¡†æ¶æ¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œè€Œè¿™ä¸ªæ¡†æ¶å°±æ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾è¦è®²çš„ EventBusã€‚</p><h2 id="eventbus-æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#eventbus-æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»" aria-hidden="true">#</a> EventBus æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»</h2><p>EventBus ç¿»è¯‘ä¸ºâ€œäº‹ä»¶æ€»çº¿â€ï¼Œå®ƒæä¾›äº†å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„éª¨æ¶ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤æ¡†æ¶ï¼Œéå¸¸å®¹æ˜“åœ°åœ¨è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¸éœ€è¦ä»é›¶å¼€å§‹å¼€å‘ã€‚å…¶ä¸­ï¼ŒGoogle Guava EventBus å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒè‘—åçš„ EventBus æ¡†æ¶ï¼Œå®ƒä¸ä»…ä»…æ”¯æŒå¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåŒæ­¥é˜»å¡æ¨¡å¼</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼ŒGuava EventBus å…·æœ‰å“ªäº›åŠŸèƒ½ã€‚è¿˜æ˜¯ä¸ŠèŠ‚è¯¾é‚£ä¸ªç”¨æˆ·æ³¨å†Œçš„ä¾‹å­ï¼Œæˆ‘ä»¬ç”¨ Guava EventBus é‡æ–°å®ç°ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
    
  <span class="token keyword">private</span> <span class="token class-name">EventBus</span> eventBus<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_EVENTBUS_THREAD_POOL_SIZE</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    
  <span class="token keyword">public</span> <span class="token class-name">UserController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//eventBus = new EventBus(); // åŒæ­¥é˜»å¡æ¨¡å¼</span>
    eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncEventBus</span><span class="token punctuation">(</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_EVENTBUS_THREAD_POOL_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¼‚æ­¥éé˜»å¡æ¨¡å¼</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRegObservers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> observers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> observer <span class="token operator">:</span> observers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      eventBus<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> telephone<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//çœç•¥è¾“å…¥å‚æ•°çš„æ ¡éªŒä»£ç </span>
    <span class="token comment">//çœç•¥userService.register()å¼‚å¸¸çš„try-catchä»£ç </span>
    <span class="token keyword">long</span> userId <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>telephone<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    eventBus<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    <span class="token keyword">return</span> userId<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegPromotionObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">PromotionService</span> promotionService<span class="token punctuation">;</span> <span class="token comment">// ä¾èµ–æ³¨å…¥</span>
    
  <span class="token annotation punctuation">@Subscribe</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promotionService<span class="token punctuation">.</span><span class="token function">issueNewUserExperienceCash</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegNotificationObserver</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">NotificationService</span> notificationService<span class="token punctuation">;</span>
    
  <span class="token annotation punctuation">@Subscribe</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRegSuccess</span><span class="token punctuation">(</span><span class="token keyword">long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    notificationService<span class="token punctuation">.</span><span class="token function">sendInboxMessage</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ©ç”¨ EventBus æ¡†æ¶å®ç°çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè·Ÿä»é›¶å¼€å§‹ç¼–å†™çš„è§‚å¯Ÿè€…æ¨¡å¼ç›¸æ¯”ï¼Œä»å¤§çš„æµç¨‹ä¸Šæ¥è¯´ï¼Œå®ç°æ€è·¯å¤§è‡´ä¸€æ ·ï¼Œéƒ½éœ€è¦å®šä¹‰ Observerï¼Œå¹¶ä¸”é€šè¿‡ register() å‡½æ•°æ³¨å†Œ Observerï¼Œä¹Ÿéƒ½éœ€è¦é€šè¿‡è°ƒç”¨æŸä¸ªå‡½æ•°ï¼ˆæ¯”å¦‚ï¼ŒEventBus ä¸­çš„ post() å‡½æ•°ï¼‰æ¥ç»™ Observer å‘é€æ¶ˆæ¯ï¼ˆåœ¨ EventBus ä¸­æ¶ˆæ¯è¢«ç§°ä½œäº‹ä»¶ eventï¼‰ã€‚</p><p>ä½†åœ¨å®ç°ç»†èŠ‚æ–¹é¢ï¼Œå®ƒä»¬åˆæœ‰äº›åŒºåˆ«ã€‚åŸºäº EventBusï¼Œæˆ‘ä»¬ä¸éœ€è¦å®šä¹‰ Observer æ¥å£ï¼Œä»»æ„ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥æ³¨å†Œåˆ° EventBus ä¸­ï¼Œé€šè¿‡ @Subscribe æ³¨è§£æ¥æ ‡æ˜ç±»ä¸­å“ªä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶è¢«è§‚å¯Ÿè€…å‘é€çš„æ¶ˆæ¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†åœ°è®²ä¸€ä¸‹ï¼ŒGuava EventBus çš„å‡ ä¸ªä¸»è¦çš„ç±»å’Œå‡½æ•°ã€‚</p><ul><li>EventBusã€AsyncEventBus</li></ul><p>Guava EventBus å¯¹å¤–æš´éœ²çš„æ‰€æœ‰å¯è°ƒç”¨æ¥å£ï¼Œéƒ½å°è£…åœ¨ EventBus ç±»ä¸­ã€‚å…¶ä¸­ï¼ŒEventBus å®ç°äº†åŒæ­¥é˜»å¡çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒAsyncEventBus ç»§æ‰¿è‡ª EventBusï¼Œæä¾›äº†å¼‚æ­¥éé˜»å¡çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">EventBus</span> eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒæ­¥é˜»å¡æ¨¡å¼</span>
<span class="token class-name">EventBus</span> eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncEventBus</span><span class="token punctuation">(</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>ï¼›<span class="token comment">// å¼‚æ­¥é˜»å¡æ¨¡å¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>register() å‡½æ•°</li></ul><p>EventBus ç±»æä¾›äº† register() å‡½æ•°ç”¨æ¥æ³¨å†Œè§‚å¯Ÿè€…ã€‚å…·ä½“çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚å®ƒå¯ä»¥æ¥å—ä»»ä½•ç±»å‹ï¼ˆObjectï¼‰çš„è§‚å¯Ÿè€…ã€‚è€Œåœ¨ç»å…¸çš„è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ä¸­ï¼Œregister() å‡½æ•°å¿…é¡»æ¥å—å®ç°äº†åŒä¸€ Observer æ¥å£çš„ç±»å¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>unregister() å‡½æ•°</li></ul><p>ç›¸å¯¹äº register() å‡½æ•°ï¼Œunregister() å‡½æ•°ç”¨æ¥ä» EventBus ä¸­åˆ é™¤æŸä¸ªè§‚å¯Ÿè€…ã€‚æˆ‘å°±ä¸å¤šè§£é‡Šäº†ï¼Œå…·ä½“çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unregister</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>post() å‡½æ•°</li></ul><p>EventBus ç±»æä¾›äº† post() å‡½æ•°ï¼Œç”¨æ¥ç»™è§‚å¯Ÿè€…å‘é€æ¶ˆæ¯ã€‚å…·ä½“çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è·Ÿç»å…¸çš„è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå½“æˆ‘ä»¬è°ƒç”¨ post() å‡½æ•°å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¹¶éæŠŠæ¶ˆæ¯å‘é€ç»™æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œè€Œæ˜¯å‘é€ç»™å¯åŒ¹é…çš„è§‚å¯Ÿè€…ã€‚æ‰€è°“å¯åŒ¹é…æŒ‡çš„æ˜¯ï¼Œèƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹æ˜¯å‘é€æ¶ˆæ¯ï¼ˆpost å‡½æ•°å®šä¹‰ä¸­çš„ eventï¼‰ç±»å‹çš„çˆ¶ç±»ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>æ¯”å¦‚ï¼ŒAObserver èƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹æ˜¯ XMsgï¼ŒBObserver èƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹æ˜¯ YMsgï¼ŒCObserver èƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹æ˜¯ ZMsgã€‚å…¶ä¸­ï¼ŒXMsg æ˜¯ YMsg çš„çˆ¶ç±»ã€‚å½“æˆ‘ä»¬å¦‚ä¸‹å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œç›¸åº”èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯çš„å¯åŒ¹é…è§‚å¯Ÿè€…å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">XMsg</span> xMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">YMsg</span> yMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ZMsg</span> zMsg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">post</span><span class="token punctuation">(</span>xMsg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">AObserver</span>æ¥æ”¶åˆ°æ¶ˆæ¯
<span class="token function">post</span><span class="token punctuation">(</span>yMsg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">AObserver</span>ã€<span class="token class-name">BObserver</span>æ¥æ”¶åˆ°æ¶ˆæ¯
<span class="token function">post</span><span class="token punctuation">(</span>zMsg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token class-name">CObserver</span>æ¥æ”¶åˆ°æ¶ˆæ¯
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ¯ä¸ª Observer èƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹æ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹ Guava EventBus æœ€ç‰¹åˆ«çš„ä¸€ä¸ªåœ°æ–¹ï¼Œé‚£å°±æ˜¯ @Subscribe æ³¨è§£ã€‚</p><ul><li>@Subscribe æ³¨è§£</li></ul><p>EventBus é€šè¿‡ @Subscribe æ³¨è§£æ¥æ ‡æ˜ï¼ŒæŸä¸ªå‡½æ•°èƒ½æ¥æ”¶å“ªç§ç±»å‹çš„æ¶ˆæ¯ã€‚å…·ä½“çš„ä½¿ç”¨ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚åœ¨ DObserver ç±»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ @Subscribe æ³¨è§£äº†ä¸¤ä¸ªå‡½æ•° f1()ã€f2()ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">DObserver</span> <span class="token punctuation">{</span>
  <span class="token comment">//...çœç•¥å…¶ä»–å±æ€§å’Œæ–¹æ³•...</span>
  
  <span class="token annotation punctuation">@Subscribe</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token class-name">PMsg</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//... }</span>
  
  <span class="token annotation punctuation">@Subscribe</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token class-name">QMsg</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//... }</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“é€šè¿‡ register() å‡½æ•°å°† DObserver ç±»å¯¹è±¡æ³¨å†Œåˆ° EventBus çš„æ—¶å€™ï¼ŒEventBus ä¼šæ ¹æ® @Subscribe æ³¨è§£æ‰¾åˆ° f1() å’Œ f2()ï¼Œå¹¶ä¸”å°†ä¸¤ä¸ªå‡½æ•°èƒ½æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹è®°å½•ä¸‹æ¥ï¼ˆPMsg-&gt;f1ï¼ŒQMsg-&gt;f2ï¼‰ã€‚å½“æˆ‘ä»¬é€šè¿‡ post() å‡½æ•°å‘é€æ¶ˆæ¯ï¼ˆæ¯”å¦‚ QMsg æ¶ˆæ¯ï¼‰çš„æ—¶å€™ï¼ŒEventBus ä¼šé€šè¿‡ä¹‹å‰çš„è®°å½•ï¼ˆQMsg-&gt;f2ï¼‰ï¼Œè°ƒç”¨ç›¸åº”çš„å‡½æ•°ï¼ˆf2ï¼‰ã€‚</p><h2 id="æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª-eventbus-æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª-eventbus-æ¡†æ¶" aria-hidden="true">#</a> æ‰‹æŠŠæ‰‹å®ç°ä¸€ä¸ª EventBus æ¡†æ¶</h2><p>Guava EventBus çš„åŠŸèƒ½æˆ‘ä»¬å·²ç»è®²æ¸…æ¥šäº†ï¼Œæ€»ä½“ä¸Šæ¥è¯´ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é‡å¤é€ è½®å­ï¼Œâ€œå±±å¯¨â€ä¸€ä¸ª EventBus å‡ºæ¥ã€‚</p><p>æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ï¼ŒEventBus ä¸­ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•° register() å’Œ post() çš„å®ç°åŸç†ã€‚å¼„æ‡‚äº†å®ƒä»¬ï¼ŒåŸºæœ¬ä¸Šå°±å¼„æ‡‚äº†æ•´ä¸ª EventBus æ¡†æ¶ã€‚ä¸‹é¢ä¸¤å¼ å›¾æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°åŸç†å›¾ã€‚</p><img src="https://personal-site-pictures.oss-cn-beijing.aliyuncs.com/img/image-20220610100026734.png" alt="image-20220610100026734" style="zoom:50%;"><img src="https://personal-site-pictures.oss-cn-beijing.aliyuncs.com/img/image-20220610100041871.png" alt="image-20220610100041871" style="zoom:50%;"><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæœ€å…³é”®çš„ä¸€ä¸ªæ•°æ®ç»“æ„æ˜¯ Observer æ³¨å†Œè¡¨ï¼Œè®°å½•äº†æ¶ˆæ¯ç±»å‹å’Œå¯æ¥æ”¶æ¶ˆæ¯å‡½æ•°çš„å¯¹åº”å…³ç³»ã€‚å½“è°ƒç”¨ register() å‡½æ•°æ³¨å†Œè§‚å¯Ÿè€…çš„æ—¶å€™ï¼ŒEventBus é€šè¿‡è§£æ @Subscribe æ³¨è§£ï¼Œç”Ÿæˆ Observer æ³¨å†Œè¡¨ã€‚å½“è°ƒç”¨ post() å‡½æ•°å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼ŒEventBus é€šè¿‡æ³¨å†Œè¡¨æ‰¾åˆ°ç›¸åº”çš„å¯æ¥æ”¶æ¶ˆæ¯çš„å‡½æ•°ï¼Œç„¶åé€šè¿‡ Java çš„åå°„è¯­æ³•æ¥åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€æ‰§è¡Œå‡½æ•°ã€‚å¯¹äºåŒæ­¥é˜»å¡æ¨¡å¼ï¼ŒEventBus åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ä¾æ¬¡æ‰§è¡Œç›¸åº”çš„å‡½æ•°ã€‚å¯¹äºå¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼ŒEventBus é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ± æ¥æ‰§è¡Œç›¸åº”çš„å‡½æ•°ã€‚</p><p>å¼„æ‡‚äº†åŸç†ï¼Œå®ç°èµ·æ¥å°±ç®€å•å¤šäº†ã€‚æ•´ä¸ªå°æ¡†æ¶çš„ä»£ç å®ç°åŒ…æ‹¬ 5 ä¸ªç±»ï¼šEventBusã€AsyncEventBusã€Subscribeã€ObserverActionã€ObserverRegistryã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ä¸‹è¿™ 5 ä¸ªç±»ã€‚</p><h3 id="_1-subscribe" tabindex="-1"><a class="header-anchor" href="#_1-subscribe" aria-hidden="true">#</a> 1.Subscribe</h3><p>Subscribe æ˜¯ä¸€ä¸ªæ³¨è§£ï¼Œç”¨äºæ ‡æ˜è§‚å¯Ÿè€…ä¸­çš„å“ªä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶æ¶ˆæ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Beta</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Subscribe</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-observeraction" tabindex="-1"><a class="header-anchor" href="#_2-observeraction" aria-hidden="true">#</a> 2.ObserverAction</h3><p>ObserverAction ç±»ç”¨æ¥è¡¨ç¤º @Subscribe æ³¨è§£çš„æ–¹æ³•ï¼Œå…¶ä¸­ï¼Œtarget è¡¨ç¤ºè§‚å¯Ÿè€…ç±»ï¼Œmethod è¡¨ç¤ºæ–¹æ³•ã€‚å®ƒä¸»è¦ç”¨åœ¨ ObserverRegistry è§‚å¯Ÿè€…æ³¨å†Œè¡¨ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObserverAction</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Method</span> method<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">ObserverAction</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token class-name">Preconditions</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> method<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// eventæ˜¯methodæ–¹æ³•çš„å‚æ•°</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> <span class="token operator">|</span> <span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-observerregistry" tabindex="-1"><a class="header-anchor" href="#_3-observerregistry" aria-hidden="true">#</a> 3.ObserverRegistry</h3><p>ObserverRegistry ç±»å°±æ˜¯å‰é¢è®²åˆ°çš„ Observer æ³¨å†Œè¡¨ï¼Œæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªç±»ï¼Œæ¡†æ¶ä¸­å‡ ä¹æ‰€æœ‰çš„æ ¸å¿ƒé€»è¾‘éƒ½åœ¨è¿™ä¸ªç±»ä¸­ã€‚è¿™ä¸ªç±»å¤§é‡ä½¿ç”¨äº† Java çš„åå°„è¯­æ³•ï¼Œä¸è¿‡ä»£ç æ•´ä½“æ¥è¯´éƒ½ä¸éš¾ç†è§£ï¼Œå…¶ä¸­ï¼Œä¸€ä¸ªæ¯”è¾ƒæœ‰æŠ€å·§çš„åœ°æ–¹æ˜¯ CopyOnWriteArraySet çš„ä½¿ç”¨ã€‚</p><p>CopyOnWriteArraySetï¼Œé¡¾åæ€ä¹‰ï¼Œåœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ setï¼Œå¹¶ä¸”å°†åŸå§‹æ•°æ® clone åˆ°æ–°çš„ set ä¸­ï¼Œåœ¨æ–°çš„ set ä¸­å†™å…¥æ•°æ®å®Œæˆä¹‹åï¼Œå†ç”¨æ–°çš„ set æ›¿æ¢è€çš„ setã€‚è¿™æ ·å°±èƒ½ä¿è¯åœ¨å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¸å½±å“æ•°æ®çš„è¯»å–æ“ä½œï¼Œä»¥æ­¤æ¥è§£å†³è¯»å†™å¹¶å‘é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCopyOnWriteSet è¿˜é€šè¿‡åŠ é”çš„æ–¹å¼ï¼Œé¿å…äº†å¹¶å‘å†™å†²çªã€‚å…·ä½“çš„ä½œç”¨ä½ å¯ä»¥å»æŸ¥çœ‹ä¸€ä¸‹ CopyOnWriteSet ç±»çš„æºç ï¼Œä¸€ç›®äº†ç„¶ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObserverRegistry</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Object</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> observerActions <span class="token operator">=</span> <span class="token function">findAllObserverActions</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> observerActions<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> eventType <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> eventActions <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> registeredEventActions <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>registeredEventActions <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registeredEventActions <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      registeredEventActions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>eventActions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMatchedObserverActions</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> matchedObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> postedEventType <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> registry<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> eventType <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> eventActions <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>postedEventType<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matchedObservers<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>eventActions<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> matchedObservers<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllObserverActions</span><span class="token punctuation">(</span><span class="token class-name">Object</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> observerActions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> observer<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> <span class="token function">getAnnotatedMethods</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> eventType <span class="token operator">=</span> parameterTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>observerActions<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        observerActions<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      observerActions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObserverAction</span><span class="token punctuation">(</span>observer<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> observerActions<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAnnotatedMethods</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Method</span><span class="token punctuation">&gt;</span></span> annotatedMethods <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Subscribe</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Preconditions</span><span class="token punctuation">.</span><span class="token function">checkArgument</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Method %s has @Subscribe annotation but has %s parameters.&quot;</span>
                        <span class="token operator">+</span> <span class="token string">&quot;Subscriber methods must have exactly 1 parameter.&quot;</span><span class="token punctuation">,</span>
                method<span class="token punctuation">,</span> parameterTypes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        annotatedMethods<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> annotatedMethods<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-eventbus" tabindex="-1"><a class="header-anchor" href="#_4-eventbus" aria-hidden="true">#</a> 4.EventBus</h3><p>EventBus å®ç°çš„æ˜¯é˜»å¡åŒæ­¥çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚çœ‹ä»£ç ä½ å¯èƒ½ä¼šæœ‰äº›ç–‘é—®ï¼Œè¿™æ˜æ˜å°±ç”¨åˆ°äº†çº¿ç¨‹æ±  Executor å•Šã€‚å®é™…ä¸Šï¼ŒMoreExecutors.directExecutor() æ˜¯ Google Guava æä¾›çš„å·¥å…·ç±»ï¼Œçœ‹ä¼¼æ˜¯å¤šçº¿ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å•çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¦è¿™ä¹ˆå®ç°ï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†è·Ÿ AsyncEventBus ç»Ÿä¸€ä»£ç é€»è¾‘ï¼Œåšåˆ°ä»£ç å¤ç”¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">ObserverRegistry</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObserverRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">MoreExecutors</span><span class="token punctuation">.</span><span class="token function">directExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>executor <span class="token operator">=</span> executor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    registry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ObserverAction</span><span class="token punctuation">&gt;</span></span> observerActions <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getMatchedObserverActions</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ObserverAction</span> observerAction <span class="token operator">:</span> observerActions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          observerAction<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-asynceventbus" tabindex="-1"><a class="header-anchor" href="#_5-asynceventbus" aria-hidden="true">#</a> 5.AsyncEventBus</h3><p>æœ‰äº† EventBusï¼ŒAsyncEventBus çš„å®ç°å°±éå¸¸ç®€å•äº†ã€‚ä¸ºäº†å®ç°å¼‚æ­¥éé˜»å¡çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå°±ä¸èƒ½å†ç»§ç»­ä½¿ç”¨ MoreExecutors.directExecutor() äº†ï¼Œè€Œæ˜¯éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œç”±è°ƒç”¨è€…æ³¨å…¥çº¿ç¨‹æ± ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncEventBus</span> <span class="token keyword">extends</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">AsyncEventBus</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç”¨äº†ä¸åˆ° 200 è¡Œä»£ç ï¼Œå°±å®ç°äº†ä¸€ä¸ªè¿˜ç®—å‡‘æ´»èƒ½ç”¨çš„ EventBusï¼Œä»åŠŸèƒ½ä¸Šæ¥è®²ï¼Œå®ƒè·Ÿ Google Guava EventBus å‡ ä¹ä¸€æ ·ã€‚ä¸è¿‡ï¼Œå¦‚æœå»æŸ¥çœ‹<code>Google Guava EventBus</code> çš„æºç ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨å®ç°ç»†èŠ‚æ–¹é¢ï¼Œç›¸æ¯”æˆ‘ä»¬ç°åœ¨çš„å®ç°ï¼Œå®ƒå…¶å®åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ¯”å¦‚ä¼˜åŒ–äº†åœ¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾æ¶ˆæ¯å¯åŒ¹é…å‡½æ•°çš„ç®—æ³•ã€‚å¦‚æœæœ‰æ—¶é—´çš„è¯ï¼Œå»ºè®®ä½ å»è¯»ä¸€ä¸‹å®ƒçš„æºç ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>è®¾è®¡æ¨¡å¼è¦å¹²çš„äº‹æƒ…å°±æ˜¯è§£è€¦ï¼Œåˆ›å»ºå‹æ¨¡å¼æ˜¯å°†åˆ›å»ºå’Œä½¿ç”¨ä»£ç è§£è€¦ï¼Œç»“æ„å‹æ¨¡å¼æ˜¯å°†ä¸åŒåŠŸèƒ½ä»£ç è§£è€¦ï¼Œè¡Œä¸ºå‹æ¨¡å¼æ˜¯å°†ä¸åŒçš„è¡Œä¸ºä»£ç è§£è€¦ï¼Œå…·ä½“åˆ°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä»£ç è§£è€¦ã€‚å€ŸåŠ©è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬åˆ©ç”¨æ›´å¥½çš„ä»£ç ç»“æ„ï¼Œå°†ä¸€å¤§å¨ä»£ç æ‹†åˆ†æˆèŒè´£æ›´å•ä¸€çš„å°ç±»ï¼Œè®©å…¶æ»¡è¶³å¼€é—­åŸåˆ™ã€é«˜å†…èšä½è€¦åˆç­‰ç‰¹æ€§ï¼Œä»¥æ­¤æ¥æ§åˆ¶å’Œåº”å¯¹ä»£ç çš„å¤æ‚æ€§ï¼Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§ã€‚</p><p>è§‚å¯Ÿè€…æ¨¡å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå°åˆ°ä»£ç å±‚é¢çš„è§£è€¦ï¼Œå¤§åˆ°æ¶æ„å±‚é¢çš„ç³»ç»Ÿè§£è€¦ï¼Œå†æˆ–è€…ä¸€äº›äº§å“çš„è®¾è®¡æ€è·¯ï¼Œéƒ½æœ‰è¿™ç§æ¨¡å¼çš„å½±å­ï¼Œæ¯”å¦‚ï¼Œé‚®ä»¶è®¢é˜…ã€RSS Feedsï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ä¸‹ï¼Œè¿™ä¸ªæ¨¡å¼ä¹Ÿæœ‰æˆªç„¶ä¸åŒçš„å®ç°æ–¹å¼ï¼Œæœ‰åŒæ­¥é˜»å¡çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰å¼‚æ­¥éé˜»å¡çš„å®ç°æ–¹å¼ï¼›æœ‰è¿›ç¨‹å†…çš„å®ç°æ–¹å¼ï¼Œä¹Ÿæœ‰è·¨è¿›ç¨‹çš„å®ç°æ–¹å¼ã€‚</p><p>æ¡†æ¶çš„ä½œç”¨æœ‰ï¼šéšè—å®ç°ç»†èŠ‚ï¼Œé™ä½å¼€å‘éš¾åº¦ï¼Œåšåˆ°ä»£ç å¤ç”¨ï¼Œè§£è€¦ä¸šåŠ¡ä¸éä¸šåŠ¡ä»£ç ï¼Œè®©ç¨‹åºå‘˜èšç„¦ä¸šåŠ¡å¼€å‘ã€‚é’ˆå¯¹å¼‚æ­¥éé˜»å¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒæŠ½è±¡æˆæ¡†æ¶æ¥è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œè€Œè¿™ä¸ªæ¡†æ¶å°±æ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾è®²çš„ EventBusã€‚EventBus ç¿»è¯‘ä¸ºâ€œäº‹ä»¶æ€»çº¿â€ï¼Œå®ƒæä¾›äº†å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„éª¨æ¶ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤æ¡†æ¶ï¼Œéå¸¸å®¹æ˜“åœ°åœ¨è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¸éœ€è¦ä»é›¶å¼€å§‹å¼€å‘ã€‚</p><p>å¾ˆå¤šäººè§‰å¾—åšä¸šåŠ¡å¼€å‘æ²¡æœ‰æŠ€æœ¯æŒ‘æˆ˜ï¼Œå®é™…ä¸Šï¼Œåšä¸šåŠ¡å¼€å‘ä¹Ÿä¼šæ¶‰åŠå¾ˆå¤šéä¸šåŠ¡åŠŸèƒ½çš„å¼€å‘ï¼Œæ¯”å¦‚ä»Šå¤©è®²åˆ°çš„ EventBusã€‚åœ¨å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¦å–„äºæŠ½è±¡è¿™äº›éä¸šåŠ¡çš„ã€å¯å¤ç”¨çš„åŠŸèƒ½ï¼Œå¹¶ç§¯æåœ°æŠŠå®ƒä»¬å®ç°æˆé€šç”¨çš„æ¡†æ¶ã€‚</p><h2 id="æ€è€ƒé¢˜" tabindex="-1"><a class="header-anchor" href="#æ€è€ƒé¢˜" aria-hidden="true">#</a> æ€è€ƒé¢˜</h2><p>è¯·å¯¹æ¯”ä¸€ä¸‹â€œç”Ÿäº§è€… - æ¶ˆè´¹è€…â€æ¨¡å‹å’Œè§‚å¯Ÿè€…æ¨¡å¼çš„åŒºåˆ«å’Œè”ç³»ã€‚</p><blockquote><p>å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼Œæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå¯ä»¥ä»¥åŒæ­¥çš„æ–¹å¼å®ç°ï¼Œä¹Ÿå¯ä»¥ä»¥å¼‚æ­¥çš„æ–¹å¼å®ç°ã€‚</p><p>ç”Ÿäº§-æ¶ˆè´¹æ¨¡å‹ï¼Œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œä¸€èˆ¬ä»¥å¼‚æ­¥çš„æ–¹å¼å®ç°</p><p>ä¸¤è€…éƒ½å¯ä»¥è¾¾åˆ°è§£è€¦çš„ä½œç”¨</p></blockquote><p>é™¤äº†ä»Šå¤©æåˆ°çš„è§‚å¯Ÿè€…æ¨¡å¼çš„å‡ ä¸ªåº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚é‚®ä»¶è®¢é˜…ï¼Œä½ è¿˜èƒ½æƒ³åˆ°æœ‰å“ªäº›å…¶ä»–çš„åº”ç”¨åœºæ™¯å—ï¼Ÿ</p><blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>ç”µå•†ç³»ç»Ÿä¸­ï¼Œäº¤æ˜“ç³»ç»Ÿåœ¨è¾¾æˆäº¤æ˜“åï¼Œéœ€è¦é€šçŸ¥ä¸‹æ¸¸çš„è¥é”€ã€ç‰©æµã€æ”¯ä»˜ã€å®¢æœç­‰å­ç³»ç»Ÿï¼Œè¿™ä¸ªåœºæ™¯æ˜¯éå¸¸ç»å…¸çš„è§‚å¯Ÿè€…æ¨¡å¼</p></blockquote><p>åœ¨ç¬¬äºŒä¸ªæ¨¡å—â€œEventBus æ¡†æ¶åŠŸèƒ½éœ€æ±‚ä»‹ç»â€ä¸­ï¼Œæˆ‘ä»¬ç”¨ Guava EventBus é‡æ–°å®ç°äº† UserControllerï¼Œå®é™…ä¸Šï¼Œä»£ç è¿˜æ˜¯ä¸å¤Ÿè§£è€¦ã€‚UserController è¿˜æ˜¯è€¦åˆäº†å¾ˆå¤šè·Ÿè§‚å¯Ÿè€…æ¨¡å¼ç›¸å…³çš„éä¸šåŠ¡ä»£ç ï¼Œæ¯”å¦‚åˆ›å»ºçº¿ç¨‹æ± ã€æ³¨å†Œ Observerã€‚ä¸ºäº†è®© UserController æ›´åŠ èšç„¦åœ¨ä¸šåŠ¡åŠŸèƒ½ä¸Šï¼Œä½ æœ‰ä»€ä¹ˆé‡æ„çš„å»ºè®®å—ï¼Ÿ</p><blockquote><p>ä»£ç†æ¨¡å¼ï¼Œä½¿ç”¨ä¸€ä¸ªä»£ç†ç±»ä¸“é—¨æ¥å¤„ç†EventBusç›¸å…³é€»è¾‘ã€‚ä½œç”¨ï¼š</p><ol><li><p>å°†ä¸šåŠ¡ä¸éä¸šåŠ¡é€»è¾‘åˆ†ç¦»</p></li><li><p>åç»­æ›¿æ¢EventBuså®ç°æ–¹å¼ç›´æ¥æ”¹å†™ä»£ç†ç±»ï¼Œæ»¡è¶³æ‹“å±•éœ€æ±‚</p></li></ol></blockquote></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zhanglianfen/zhanglianfen.github.io/edit/main/docs/zh/basics/design-patterns/behavioral-patterns/Observer.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 454486214@qq.com">zhanglf</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/zh/basics/design-patterns/behavioral-patterns/" class="nav-link active prev" aria-label="æ¦‚è¿°"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->æ¦‚è¿°</div></a><a href="/zh/basics/design-patterns/behavioral-patterns/Template-method.html" class="nav-link next" aria-label="æ¨¡æ¿æ¨¡å¼"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">æ¨¡æ¿æ¨¡å¼<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">å¾ˆé«˜å…´è§åˆ°ä½ </div><div class="copyright">Copyright Â© 2022 Mr.Zhang</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-563244e8.js" defer></script>
  </body>
</html>
